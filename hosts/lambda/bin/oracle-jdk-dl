#!/bin/sh
. /etc/portage/make.conf

if [ "$#" -ne 2 ]; then
	echo "Usage: $0 <version> <revision> (example 8 77)"
	exit 1
fi

VER="$1u$2"
FNAME="jdk-${VER}-linux-x64.tar.gz"

ERR=1
i=0
while true; do
	[ $i -lt 10 ] && si="0$i" || si="$i"
	wget -q --spider --header "Cookie: oraclelicense=accept-securebackup-cookie" \
		"http://download.oracle.com/otn-pub/java/jdk/${VER}-b${si}/$FNAME" \
		-O $DISTDIR/$FNAME
	ERRTMP=$?
	[ $ERRTMP != 0 -a $ERR == 0 -o $i -gt 100 ] && break
	ERR=$ERRTMP
	((i++))
	echo "searching b$si: http://download.oracle.com/otn-pub/java/jdk/${VER}-b${si}/$FNAME"
done

((i--))
[ $i -lt 10 ] && si="0$i" || si="$i"
wget --header "Cookie: oraclelicense=accept-securebackup-cookie" \
	"http://download.oracle.com/otn-pub/java/jdk/${VER}-b${si}/$FNAME" \
	-O /usr/portage/distfiles/$FNAME

sudo chown portage:portage ${DISTDIR}/$FNAME
